<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RA Geolocalizada - Demo</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    
    #info-panel {
      position: fixed;
      top: 10px;
      left: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 15px;
      border-radius: 10px;
      z-index: 999;
      font-size: 14px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    #info-panel h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: #4CAF50;
    }
    
    #info-panel p {
      margin: 5px 0;
      line-height: 1.4;
    }
    
    .coord {
      color: #64B5F6;
      font-weight: bold;
    }
    
    #loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      z-index: 1000;
    }
    
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    #instructions {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(76, 175, 80, 0.9);
      color: white;
      padding: 15px 25px;
      border-radius: 25px;
      z-index: 999;
      font-size: 14px;
      text-align: center;
      max-width: 80%;
    }
  </style>
</head>
<body>
  <div id="loading">
    <h2>Iniciando RA Geolocalizada</h2>
    <div class="spinner"></div>
    <p>Solicitando permisos de c√°mara y ubicaci√≥n...</p>
  </div>

  <div id="info-panel">
    <h3>üìç Informaci√≥n de Ubicaci√≥n</h3>
    <p><strong>Tu posici√≥n:</strong> <span class="coord" id="user-coords">Detectando...</span></p>
    <p><strong>Precisi√≥n GPS:</strong> <span id="accuracy">--</span> metros</p>
    <p><strong>Puntos cercanos:</strong> <span id="nearby">0</span></p>
    <p style="margin-top: 10px; font-size: 12px; color: #FFB74D;">
      üí° Mueve tu dispositivo para ver los objetos AR en diferentes ubicaciones
    </p>
  </div>

  <div id="instructions">
    üéØ Apunta tu c√°mara alrededor para encontrar objetos virtuales
  </div>

  <a-scene
    vr-mode-ui="enabled: false"
    arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false; trackingMethod: best;"
    renderer="logarithmicDepthBuffer: true; precision: medium;"
    embedded
    gesture-detector
    id="scene">
    
    <!-- C√°mara AR -->
    <a-camera gps-projected-camera rotation-reader look-controls-enabled="false"></a-camera>
    
    <!-- Punto de inter√©s 1: Monumento virtual a 20m al norte -->
    <a-entity
      gps-projected-entity-place="latitude: your-lat-here; longitude: your-lon-here;"
      class="poi">
      <a-box 
        position="0 1 -5" 
        color="#4CAF50" 
        scale="2 2 2"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear">
      </a-box>
      <a-text 
        value="Punto Norte" 
        align="center" 
        position="0 3.5 -5" 
        scale="3 3 3"
        color="#FFFFFF"
        look-at="[gps-projected-camera]">
      </a-text>
    </a-entity>

    <!-- Punto de inter√©s 2: Esfera virtual a 20m al sur -->
    <a-entity
      gps-projected-entity-place="latitude: your-lat-here; longitude: your-lon-here;"
      class="poi">
      <a-sphere 
        position="0 1.5 -6" 
        color="#2196F3" 
        radius="1.5"
        animation="property: position; to: 0 2.5 0; direction: alternate; loop: true; dur: 2000; easing: easeInOutSine">
      </a-sphere>
      <a-text 
        value="Punto Sur" 
        align="center" 
        position="0 4 -6" 
        scale="3 3 3"
        color="#FFFFFF"
        look-at="[gps-projected-camera]">
      </a-text>
    </a-entity>

    <!-- Punto de inter√©s 3: Cilindro virtual a 20m al este -->
    <a-entity
      gps-projected-entity-place="latitude: your-lat-here; longitude: your-lon-here;"
      class="poi">
      <a-cylinder 
        position="0 1 -6" 
        color="#FF5722" 
        radius="1" 
        height="3"
        animation="property: scale; to: 1.2 1.2 1.2; direction: alternate; loop: true; dur: 1500">
      </a-cylinder>
      <a-text 
        value="Punto Este" 
        align="center" 
        position="0 4 -6" 
        scale="3 3 3"
        color="#FFFFFF"
        look-at="[gps-projected-camera]">
      </a-text>
    </a-entity>

    <!-- Punto de inter√©s 4: Cono virtual a 20m al oeste -->
    <a-entity
      gps-projected-entity-place="latitude: your-lat-here; longitude: your-lon-here;"
      class="poi">
      <a-cone 
        position="0 1 -6" 
        color="#9C27B0" 
        radius-bottom="1.5" 
        radius-top="0.1" 
        height="3"
        animation="property: rotation; to: 360 360 0; loop: true; dur: 5000; easing: linear">
      </a-cone>
      <a-text 
        value="Punto Oeste" 
        align="center" 
        position="0 4 -6" 
        scale="3 3 3"
        color="#FFFFFF"
        look-at="[gps-projected-camera]">
      </a-text>
    </a-entity>

    <!-- Punto central: Marcador de tu ubicaci√≥n -->
    <a-entity
      gps-projected-entity-place="latitude: your-lat-here; longitude: your-lon-here;"
      class="poi">
      <a-torus 
        position="0 0.5 -32" 
        color="#FFC107" 
        radius="1" 
        radius-tubular="0.2"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 3000; easing: linear">
      </a-torus>
      <a-text 
        value="Tu Ubicaci√≥n" 
        align="center" 
        position="0 2 -32" 
        scale="2 2 2"
        color="#FFFFFF"
        look-at="[gps-projected-camera]">
      </a-text>
    </a-entity>

  </a-scene>

  <script>
    // Variables globales
    let userLat = null;
    let userLon = null;
    let pointsOfInterest = [];
    let watchId = null;

    // Funci√≥n para calcular nueva coordenada dada distancia y bearing
    function calculateDestination(lat, lon, distance, bearing) {
      const R = 6371000; // Radio de la Tierra en metros
      const Œ¥ = distance / R;
      const Œ∏ = bearing * Math.PI / 180;
      
      const œÜ1 = lat * Math.PI / 180;
      const Œª1 = lon * Math.PI / 180;
      
      const œÜ2 = Math.asin(
        Math.sin(œÜ1) * Math.cos(Œ¥) +
        Math.cos(œÜ1) * Math.sin(Œ¥) * Math.cos(Œ∏)
      );
      
      const Œª2 = Œª1 + Math.atan2(
        Math.sin(Œ∏) * Math.sin(Œ¥) * Math.cos(œÜ1),
        Math.cos(Œ¥) - Math.sin(œÜ1) * Math.sin(œÜ2)
      );
      
      return {
        lat: œÜ2 * 180 / Math.PI,
        lon: Œª2 * 180 / Math.PI
      };
    }

    // Funci√≥n para actualizar coordenadas de los POIs
    function updatePOICoordinates(lat, lon) {
      const distance = 20; // 20 metros de distancia
      
      // Norte (bearing 0¬∞)
      const north = calculateDestination(lat, lon, distance, 0);
      // Sur (bearing 180¬∞)
      const south = calculateDestination(lat, lon, distance, 180);
      // Este (bearing 90¬∞)
      const east = calculateDestination(lat, lon, distance, 90);
      // Oeste (bearing 270¬∞)
      const west = calculateDestination(lat, lon, distance, 270);
      
      pointsOfInterest = [
        { name: 'Norte', ...north },
        { name: 'Sur', ...south },
        { name: 'Este', ...east },
        { name: 'Oeste', ...west },
        { name: 'Centro', lat: lat, lon: lon }
      ];
      
      // Actualizar las entidades en la escena
      const entities = document.querySelectorAll('[gps-projected-entity-place]');
      if (entities.length >= 5) {
        entities[0].setAttribute('gps-projected-entity-place', `latitude: ${north.lat}; longitude: ${north.lon}`);
        entities[1].setAttribute('gps-projected-entity-place', `latitude: ${south.lat}; longitude: ${south.lon}`);
        entities[2].setAttribute('gps-projected-entity-place', `latitude: ${east.lat}; longitude: ${east.lon}`);
        entities[3].setAttribute('gps-projected-entity-place', `latitude: ${west.lat}; longitude: ${west.lon}`);
        entities[4].setAttribute('gps-projected-entity-place', `latitude: ${lat}; longitude: ${lon}`);
      }
      
      document.getElementById('nearby').textContent = pointsOfInterest.length;
    }

    // Funci√≥n para actualizar informaci√≥n en pantalla
    function updateLocationInfo(position) {
      userLat = position.coords.latitude;
      userLon = position.coords.longitude;
      const accuracy = position.coords.accuracy;
      
      document.getElementById('user-coords').textContent = 
        `${userLat.toFixed(6)}, ${userLon.toFixed(6)}`;
      document.getElementById('accuracy').textContent = accuracy.toFixed(1);
      
      // Actualizar coordenadas de los POIs basados en la ubicaci√≥n del usuario
      updatePOICoordinates(userLat, userLon);
      
      // Ocultar loading
      const loading = document.getElementById('loading');
      if (loading) {
        loading.style.display = 'none';
      }
    }

    // Funci√≥n de error de geolocalizaci√≥n
    function handleLocationError(error) {
      console.error('Error de geolocalizaci√≥n:', error);
      const loading = document.getElementById('loading');
      loading.innerHTML = `
        <h2>‚ö†Ô∏è Error de Ubicaci√≥n</h2>
        <p>${error.message}</p>
        <p style="font-size: 12px; margin-top: 15px;">
          Por favor, verifica que has dado permisos de ubicaci√≥n a tu navegador.
        </p>
      `;
    }

    // Inicializar geolocalizaci√≥n
    window.addEventListener('load', () => {
      // Verificar si el navegador soporta geolocalizaci√≥n
      if ('geolocation' in navigator) {
        // Solicitar ubicaci√≥n continua
        watchId = navigator.geolocation.watchPosition(
          updateLocationInfo,
          handleLocationError,
          {
            enableHighAccuracy: true,
            maximumAge: 0,
            timeout: 27000
          }
        );
      } else {
        document.getElementById('loading').innerHTML = `
          <h2>‚ùå No Soportado</h2>
          <p>Tu navegador no soporta geolocalizaci√≥n</p>
        `;
      }
    });

    // Registrar componente para que los textos siempre miren a la c√°mara
    AFRAME.registerComponent('look-at', {
      schema: { type: 'selector' },
      init: function() {
        this.target = this.data || document.querySelector('[camera]');
      },
      tick: function() {
        if (this.target) {
          this.el.object3D.lookAt(this.target.object3D.position);
        }
      }
    });

    // Limpiar al cerrar
    window.addEventListener('beforeunload', () => {
      if (watchId) {
        navigator.geolocation.clearWatch(watchId);
      }
    });
  </script>
</body>
</html>

